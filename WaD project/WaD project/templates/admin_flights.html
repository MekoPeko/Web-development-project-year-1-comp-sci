<!-- Student ID - 2400965 , Student name - Harry Masters -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight Management - Horizen Travels</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='sbooking.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>

<body>
    <!-- Navigation Bar -->
    <div class="navbar">
        <h2>Horizen Travels</h2>
        <button class="menu-toggle" id="menu-toggle">
            <i class="fas fa-bars"></i>
        </button>
        <div class="navbar-links" id="navbar-links">
            <a href="/Main"><i class="fas fa-home"></i> Home</a>
            <a href="/admin"><i class="fas fa-user-shield"></i> Admin Dashboard</a>
            <a href="/admin/accounts"><i class="fas fa-users"></i> Accounts</a>
            <a href="/admin/bookings"><i class="fas fa-ticket-alt"></i> Bookings</a>
            <a href="/admin/flights"><i class="fas fa-plane"></i> Flights</a>
            <a href="/admin/sales"><i class="fas fa-chart-line"></i> Sales</a>
            <a href="/logout"><i class="fas fa-sign-out-alt"></i> Sign Out</a>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-container">
        <div class="content">
            <h1><i class="fas fa-plane"></i> Flight Management</h1>
            <p>Welcome to the flight management section, {{ name }}.</p>
            
            <!-- Flash Messages -->
            {% with messages = get_flashed_messages() %}
              {% if messages %}
                <div class="flash-messages">
                  {% for message in messages %}
                    <p class="flash-message"><i class="fas fa-info-circle"></i> {{ message }}</p>
                  {% endfor %}
                </div>
              {% endif %}
            {% endwith %}
            
            <!-- Back button -->
            <a href="/admin" class="back-btn"><i class="fas fa-arrow-left"></i> Back to Admin Dashboard</a>
            
            <!-- Stats Summary -->
            <div class="stats-container">
                <div class="stat-card">
                    <i class="fas fa-plane-departure"></i>
                    <h3>Total Flights</h3>
                    <p>{{ flights|length }}</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-globe-americas"></i>
                    <h3>Destinations</h3>
                    <p>{{ flights|map(attribute='Arrive')|unique|list|length }}</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-dollar-sign"></i>
                    <h3>Avg. Seat Cost</h3>
                    <p>${{ "%.2f"|format(flights|map(attribute='Seat_cost')|sum / flights|length) if flights else 0 }}</p>
                </div>
            </div>
            
            <!-- Add New Flight Button -->
            <div style="margin: 20px 0; text-align: right;">
                <button class="sign-in-btn" onclick="showAddFlightForm()">
                    <i class="fas fa-plus"></i> Add New Flight
                </button>
            </div>
            
            <!-- Flight Management Section -->
            <div class="table-container">
                <h2><i class="fas fa-plane"></i> Flight Information</h2>
                
                <!-- Search and Filter -->
                <div class="filter-container">
                    <input type="text" id="flightSearch" placeholder="Search flights..." onkeyup="filterFlights()">
                    <select id="destinationFilter" onchange="filterFlights()">
                        <option value="">All Destinations</option>
                        {% for destination in flights|map(attribute='Arrive')|unique|sort %}
                            <option value="{{ destination }}">{{ destination }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <table id="flightsTable">
                    <thead>
                        <tr>
                            <th>Flight ID</th>
                            <th>From</th>
                            <th>To</th>
                            <th>Departure Time</th>
                            <th>Arrival Time</th>
                            <th>Seat Cost</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for flight in flights %}
                        <tr data-flight='{{ flight | tojson | safe }}'>
                            <td>{{ flight.idAir_jorneys }}</td>
                            <td>{{ flight.Depart }}</td>
                            <td>{{ flight.Arrive }}</td>
                            <td>{{ flight.Time_depart }}</td>
                            <td>{{ flight.Time_arrive }}</td>
                            <td>${{ "%.2f"|format(flight.Seat_cost) }}</td>
                            <td>
                                <div class="button-group">
                                    <a href="#" class="edit-btn" onclick="editFlight({{ flight.idAir_jorneys }})">
                                        <i class="fas fa-edit"></i> Edit
                                    </a>
                                    <a href="#" class="delete-btn" onclick="showDeleteModal({{ flight.idAir_jorneys }}, '{{ flight.Depart }}', '{{ flight.Arrive }}')">
                                        <i class="fas fa-trash"></i> Delete
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            Â© 2025 Horizen Travels | All Rights Reserved
        </div>
    </div>
    
    <!-- Add Flight Modal -->
    <div id="addFlightModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addFlightModal')">&times;</span>
            <h2><i class="fas fa-plus-circle"></i> Add New Flight</h2>
            
            <form action="/admin/add_flight" method="POST" class="flight-form">
                <div class="form-group">
                    <label for="depart"><i class="fas fa-plane-departure"></i> Departure City:</label>
                    <input type="text" id="depart" name="depart" required>
                </div>
                
                <div class="form-group">
                    <label for="arrive"><i class="fas fa-plane-arrival"></i> Arrival City:</label>
                    <input type="text" id="arrive" name="arrive" required>
                </div>
                
                <div class="form-group">
                    <label for="depart-time"><i class="fas fa-clock"></i> Departure Time:</label>
                    <input type="text" id="depart-time" name="depart_time" placeholder="HH:MM:SS" required>
                </div>
                
                <div class="form-group">
                    <label for="arrive-time"><i class="fas fa-clock"></i> Arrival Time:</label>
                    <input type="text" id="arrive-time" name="arrive_time" placeholder="HH:MM:SS" required>
                </div>
                
                <div class="form-group">
                    <label for="seat-cost"><i class="fas fa-dollar-sign"></i> Seat Cost:</label>
                    <input type="number" id="seat-cost" name="seat_cost" min="1" step="0.01" required>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="cancel-btn" onclick="closeModal('addFlightModal')">Cancel</button>
                    <button type="submit" class="confirm-btn">Add Flight</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Delete Flight Modal -->
    <div id="deleteFlightModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('deleteFlightModal')">&times;</span>
            <h2><i class="fas fa-exclamation-triangle" style="color: #DC2626;"></i> Delete Flight</h2>
            
            <p>Are you sure you want to delete the following flight?</p>
            <div class="flight-details" id="flightToDelete">
                <!-- Flight details will be inserted here -->
            </div>
            
            <p style="color: #DC2626; font-weight: bold;">This action cannot be undone. All associated bookings will be affected.</p>
            
            <p>To confirm deletion, please type <strong>DELETE</strong> in the box below:</p>
            
            <form action="/admin/delete_flight" method="POST" id="deleteFlightForm">
                <input type="hidden" id="flightId" name="flight_id">
                <div class="form-group">
                    <input type="text" id="deleteConfirmation" name="confirmation" required placeholder="Type DELETE to confirm">
                </div>
                
                <div class="form-actions">
                    <button type="button" class="cancel-btn" onclick="closeModal('deleteFlightModal')">Cancel</button>
                    <button type="submit" class="delete-btn" id="confirmDeleteBtn" disabled>Delete Flight</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Flight Modal -->
    <div id="editFlightModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('editFlightModal')">&times;</span>
            <h2><i class="fas fa-edit"></i> Edit Flight</h2>
            <form action="/admin/edit_flight" method="POST" class="flight-form">
                <input type="hidden" id="edit-flight-id" name="flight_id">
                <div class="form-group">
                    <label for="edit-depart"><i class="fas fa-plane-departure"></i> Departure City:</label>
                    <input type="text" id="edit-depart" name="depart" required>
                </div>
                <div class="form-group">
                    <label for="edit-arrive"><i class="fas fa-plane-arrival"></i> Arrival City:</label>
                    <input type="text" id="edit-arrive" name="arrive" required>
                </div>
                <div class="form-group">
                    <label for="edit-depart-time"><i class="fas fa-clock"></i> Departure Time:</label>
                    <input type="text" id="edit-depart-time" name="depart_time" placeholder="HH:MM:SS" required>
                </div>
                <div class="form-group">
                    <label for="edit-arrive-time"><i class="fas fa-clock"></i> Arrival Time:</label>
                    <input type="text" id="edit-arrive-time" name="arrive_time" placeholder="HH:MM:SS" required>
                </div>
                <div class="form-group">
                    <label for="edit-seat-cost"><i class="fas fa-dollar-sign"></i> Seat Cost:</label>
                    <input type="number" id="edit-seat-cost" name="seat_cost" min="1" step="0.01" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="cancel-btn" onclick="closeModal('editFlightModal')">Cancel</button>
                    <button type="submit" class="confirm-btn">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Mobile menu toggle
        document.getElementById('menu-toggle').addEventListener('click', function() {
            document.getElementById('navbar-links').classList.toggle('active');
        });
        
        // Filter flights based on search input and destination
        function filterFlights() {
            const searchText = document.getElementById('flightSearch').value.toLowerCase();
            const destination = document.getElementById('destinationFilter').value;
            const rows = document.getElementById('flightsTable').getElementsByTagName('tbody')[0].rows;
            
            for (let i = 0; i < rows.length; i++) {
                const flightId = rows[i].cells[0].textContent.toLowerCase();
                const from = rows[i].cells[1].textContent.toLowerCase();
                const to = rows[i].cells[2].textContent.toLowerCase();
                const flightDestination = rows[i].cells[2].textContent;
                
                const textMatch = flightId.includes(searchText) || 
                                 from.includes(searchText) || 
                                 to.includes(searchText);
                const destinationMatch = destination === '' || flightDestination === destination;
                
                if (textMatch && destinationMatch) {
                    rows[i].style.display = '';
                } else {
                    rows[i].style.display = 'none';
                }
            }
        }
        
        // Show Add Flight Modal
        function showAddFlightForm() {
            document.getElementById('addFlightModal').style.display = 'block';
        }
        
        // Show Delete Flight Modal
        function showDeleteModal(flightId, departCity, arriveCity) {
            // Set the flight ID in the hidden field
            document.getElementById('flightId').value = flightId;
            
            // Display flight details
            document.getElementById('flightToDelete').innerHTML = `
                <div class="detail-row">
                    <span class="detail-label">Flight ID:</span>
                    <span class="detail-value">${flightId}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Route:</span>
                    <span class="detail-value">${departCity} to ${arriveCity}</span>
                </div>
            `;
            
            // Clear the confirmation field
            document.getElementById('deleteConfirmation').value = '';
            document.getElementById('confirmDeleteBtn').disabled = true;
            
            // Show the modal
            document.getElementById('deleteFlightModal').style.display = 'block';
        }
        
        // Enable/disable delete button based on confirmation text
        document.getElementById('deleteConfirmation').addEventListener('input', function() {
            const confirmBtn = document.getElementById('confirmDeleteBtn');
            if (this.value === 'DELETE') {
                confirmBtn.disabled = false;
            } else {
                confirmBtn.disabled = true;
            }
        });
        
        // Close any modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.className === 'modal') {
                event.target.style.display = 'none';
            }
        }
        
        // Placeholder for future edit functionality
        function editFlight(flightId) {
            // Find the row with the matching flightId
            const rows = document.querySelectorAll('#flightsTable tbody tr');
            let flightData = null;
            rows.forEach(row => {
                const data = row.getAttribute('data-flight');
                if (data) {
                    const flight = JSON.parse(data);
                    if (String(flight.idAir_jorneys) === String(flightId)) {
                        flightData = flight;
                    }
                }
            });
            if (!flightData) {
                alert('Flight data not found.');
                return;
            }
            // Populate modal fields
            document.getElementById('edit-flight-id').value = flightData.idAir_jorneys;
            document.getElementById('edit-depart').value = flightData.Depart;
            document.getElementById('edit-arrive').value = flightData.Arrive;
            document.getElementById('edit-depart-time').value = flightData.Time_depart;
            document.getElementById('edit-arrive-time').value = flightData.Time_arrive;
            document.getElementById('edit-seat-cost').value = flightData.Seat_cost;
            // Show modal
            document.getElementById('editFlightModal').style.display = 'block';
        }
    </script>
</body>
</html>
